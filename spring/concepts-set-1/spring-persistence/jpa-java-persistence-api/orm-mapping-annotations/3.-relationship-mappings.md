# 3. Relationship Mappings

## 1. @OneToOne

### About

* `@OneToOne` defines a **one-to-one** relationship **between two entity classes**.
* It means **each instance** of Entity A **is associated with exactly one instance** of Entity B, and vice versa.
* It is **bidirectional** or **unidirectional** based on how we model the relationship.

{% hint style="info" %}
Example - Employee and EmployeeDetails

* Each Employee has **one** EmployeeDetails record.
* Each EmployeeDetails is linked to exactly **one** Employee.
{% endhint %}

### Syntax

```java
@Entity
public class Employee {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String name;
    
    @OneToOne
    private EmployeeDetails details;
}
```

This maps a simple **unidirectional** `@OneToOne` — Employee has a link to EmployeeDetails.

## Attributes

<table data-full-width="true"><thead><tr><th width="187.12890625">Attribute</th><th>Description</th></tr></thead><tbody><tr><td><code>mappedBy</code></td><td>Indicates the <strong>inverse</strong> side of the relationship (used in bidirectional mapping).</td></tr><tr><td><code>cascade</code></td><td>Defines cascade operations like persist, remove, merge etc.</td></tr><tr><td><code>fetch</code></td><td>Defines when to fetch related entity: <code>EAGER</code> (default) or <code>LAZY</code>.</td></tr><tr><td><code>optional</code></td><td>Whether the relationship is mandatory (<code>false</code>) or optional (<code>true</code>). Default is <code>true</code>.</td></tr><tr><td><code>orphanRemoval</code></td><td>Whether to automatically remove orphaned records.</td></tr></tbody></table>

### How Relationships Are Stored in Database

* Usually through a **foreign key**.
* Typically one table has a **foreign key reference** to the other table.

For example:

```sql
create table employee (
    id bigint not null,
    name varchar(255),
    details_id bigint,
    primary key (id),
    foreign key (details_id) references employee_details(id)
);

create table employee_details (
    id bigint not null,
    address varchar(255),
    phone_number varchar(255),
    primary key (id)
);
```

#### 1. Unidirectional `@OneToOne`

Only one entity knows about the relationship.

```java
@Entity
public class Employee {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String name;
    
    @OneToOne(cascade = CascadeType.ALL)
    @JoinColumn(name = "details_id", referencedColumnName = "id")
    private EmployeeDetails details;
}
```

```java
@Entity
public class EmployeeDetails {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String address;
    private String phoneNumber;
}
```

* `@JoinColumn(name = "details_id", referencedColumnName = "id")`
  * `details_id` column in `employee` table holds the foreign key referencing `employee_details(id)`.
* `cascade = CascadeType.ALL`
  * If we persist or delete an Employee, EmployeeDetails will automatically be persisted or deleted too.

#### 2. Bidirectional `@OneToOne`

Both entities are aware of the relationship.

```java
@Entity
public class Employee {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;

    @OneToOne(mappedBy = "employee", cascade = CascadeType.ALL)
    private EmployeeDetails details;
}
```

```java
@Entity
public class EmployeeDetails {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String address;
    private String phoneNumber;

    @OneToOne
    @JoinColumn(name = "employee_id", referencedColumnName = "id")
    private Employee employee;
}
```

* `EmployeeDetails` owns the relationship (`@JoinColumn` is there).
* `Employee` just references it through `mappedBy = "employee"`.
* `mappedBy` tells JPA that the **foreign key is managed by the other side** (i.e., EmployeeDetails).

{% hint style="info" %}
## Cascade Types

We often want operations on the parent to affect the child entity too.\
Typical cascade types with `@OneToOne`:

* `CascadeType.PERSIST`: Save parent ➔ saves child.
* `CascadeType.REMOVE`: Delete parent ➔ deletes child.
* `CascadeType.MERGE`: Merge parent ➔ merges child.
* `CascadeType.ALL`: All operations (persist, merge, remove, refresh, detach).
{% endhint %}

{% hint style="info" %}
FetchType

* `FetchType.EAGER` (Default): Child entity is **loaded immediately** with parent entity.
* `FetchType.LAZY`: Child entity is **loaded only when accessed**.

In `@OneToOne`, default is **EAGER** (unlike `@OneToMany` where it’s LAZY).
{% endhint %}

## 2. @OneToMany



## 3. @ManyToOne



## 4. @ManyToMany



## 5. @JoinColumn



## 6. @JoinTable







